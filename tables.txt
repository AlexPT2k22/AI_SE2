-- public.parking_event_log definição

-- Drop table

-- DROP TABLE parking_event_log;

CREATE TABLE parking_event_log (
	id serial4 NOT NULL,
	detected_plate text NULL,
	final_plate text NULL,
	det_confidence numeric(5, 2) NULL,
	ocr_confidence numeric(5, 2) NULL,
	image_path text NULL,
	camera_id text NULL,
	created_at timestamptz DEFAULT now() NOT NULL,
	CONSTRAINT parking_event_log_pkey PRIMARY KEY (id)
);


-- public.parking_manual_reservations definição

-- Drop table

-- DROP TABLE parking_manual_reservations;

CREATE TABLE parking_manual_reservations (
	id int4 GENERATED ALWAYS AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	spot text NOT NULL,
	plate text NOT NULL,
	plate_norm text NOT NULL,
	reserved_by text NULL,
	reserved_until timestamptz NOT NULL,
	created_at timestamptz DEFAULT now() NOT NULL,
	CONSTRAINT parking_manual_reservations_pkey PRIMARY KEY (id),
	CONSTRAINT parking_manual_reservations_spot_key UNIQUE (spot)
);


-- public.parking_sessions definição

-- Drop table

-- DROP TABLE parking_sessions;

CREATE TABLE parking_sessions (
	id serial4 NOT NULL,
	plate text NOT NULL,
	plate_country text NULL,
	entry_time timestamptz DEFAULT now() NOT NULL,
	exit_time timestamptz NULL,
	camera_id text NULL,
	ticket_id text NULL,
	amount_due numeric(10, 2) NULL,
	amount_paid numeric(10, 2) DEFAULT 0 NULL,
	status text DEFAULT 'open'::text NOT NULL,
	notes text NULL,
	CONSTRAINT parking_sessions_pkey PRIMARY KEY (id),
	CONSTRAINT parking_sessions_ticket_id_key UNIQUE (ticket_id)
);


-- public.parking_web_users definição

-- Drop table

-- DROP TABLE parking_web_users;

CREATE TABLE parking_web_users (
	id int4 GENERATED ALWAYS AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	full_name text NOT NULL,
	plate text NOT NULL,
	plate_norm text NOT NULL,
	created_at timestamptz DEFAULT now() NOT NULL,
	user_type varchar NULL,
	CONSTRAINT parking_web_users_pkey PRIMARY KEY (id),
	CONSTRAINT parking_web_users_plate_norm_key UNIQUE (plate_norm)
);


-- public.parking_payments definição

-- Drop table

-- DROP TABLE parking_payments;

CREATE TABLE parking_payments (
	id serial4 NOT NULL,
	session_id int4 NOT NULL,
	amount numeric(10, 2) NOT NULL,
	"method" text NOT NULL,
	reference text NULL,
	paid_at timestamptz DEFAULT now() NOT NULL,
	metadata jsonb NULL,
	CONSTRAINT parking_payments_pkey PRIMARY KEY (id),
	CONSTRAINT parking_payments_session_id_fkey FOREIGN KEY (session_id) REFERENCES parking_sessions(id) ON DELETE CASCADE
);
